import json
import sys
import os

if len(sys.argv) < 3:
    print(f"Usage: {sys.argv[0]} <clamscan output ELFs> <clamscan output PE>")
    sys.exit(0)

malware_types = {}


"""
The output of clamscan is formed by the file path and the type of malware.
The objective is to use the file path as the key and the malware type (such as Trojan, Adware, etc.) as the value.

The input follows a poor pattern, but the purpose is to retrieve files
from ClamAV and include their paths in the list of scans.
"""

elf= os.path.abspath(sys.argv[1])
pe= os.path.abspath(sys.argv[2])

scans = [elf, pe]

for file in scans:
    current_file = open(file, "r")
    for line in current_file:
        vec = line.split(":")
        if not os.path.exists(vec[0]):
            continue

        path = vec[0]
        name = path.split("/")[-1]
        ty = vec[1].split(".")
        if len(ty) < 2:
            ty = "NOT FOUND"
        else:
            ty = ty[1]

        malware_types[name] = ty

    current_file.close()

with open("malwaretypes.json", "w") as f:
    j = json.dumps(malware_types, indent=4)
    f.write(j)
